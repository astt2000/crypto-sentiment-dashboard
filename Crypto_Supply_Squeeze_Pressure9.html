<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Supply Squeeze Pressure Monitor v13.3</title>
<style>
:root{
  --bg:#f6f8fb;--card:#fff;--text:#0f1720;--muted:#6b737b;
  --accent:#0b76d1;--good:#16a34a;--bad:#ef4444;--warn:#f59e0b;--neutral:#64748b;
  font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;
}
html,body{margin:0;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
body.dark{background:#071217;color:#e6eef6;--accent:#36a2ff}
.app{max-width:1080px;margin:0 auto;padding:10px}
header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;padding:8px;border-radius:10px;background:rgba(255,255,255,0.94);backdrop-filter:blur(6px);position:sticky;top:0;z-index:20;gap:8px}
.title-row{display:flex;align-items:center;gap:10px}
.title-row h1{margin:0;font-size:1.05rem;color:var(--accent);font-weight:800}
#lastUpdated{font-size:12px;color:var(--muted)}
#globalStats{font-size:13px;margin-top:4px;color:var(--text);display:flex;flex-wrap:wrap;gap:8px;align-items:center}
#globalStats span{background:rgba(0,0,0,0.04);padding:4px 8px;border-radius:8px;font-weight:600}

/* controls */
.controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
select,button{padding:6px 10px;border-radius:8px;border:0;cursor:pointer;font-weight:700;min-height:36px;font-size:14px}
.btn-primary{background:var(--accent);color:#fff}
.btn-ghost{background:transparent;border:1px solid rgba(0,0,0,0.06)}

/* scale and marker */
.scale-wrap{margin-top:10px;position:relative}
.scale{height:12px;border-radius:10px;overflow:hidden;background:linear-gradient(90deg,#ef4444,#f59e0b,#94a3b8,#06b6d4,#16a34a)}
.marker{position:absolute;top:16px;width:2px;height:46px;background:#111;border-radius:2px;transform:translateX(-1px);transition:left .55s}
.marker-dot{position:absolute;top:36px;left:-9px;width:18px;height:18px;border-radius:50%;background:#111;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:12px;padding-top:1px}

/* mood bar (color-coded) */
#moodBar{margin-top:8px;padding:8px;border-radius:8px;color:#fff;font-weight:700;text-align:center;display:flex;align-items:center;justify-content:center;gap:8px}

/* indicators row */
.indicators{margin-top:10px;display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px}
.ind-card{background:var(--card);padding:8px;border-radius:8px;text-align:center;font-weight:700;box-shadow:0 4px 10px rgba(0,0,0,0.04);cursor:help}
.ind-label{font-size:12px;color:var(--muted);font-weight:600}
.ind-value{font-size:14px;margin-top:6px}

/* grid cards */
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;margin-top:10px}
.card{display:flex;flex-direction:column;gap:8px;padding:10px;border-radius:12px;background:var(--card);box-shadow:0 6px 18px rgba(16,24,40,0.04);transition:transform .22s ease,box-shadow .22s; border:1px solid rgba(0,0,0,0.04)}
.card:hover{transform:translateY(-4px);box-shadow:0 12px 34px rgba(16,24,40,0.08)}
.card-row{display:flex;justify-content:space-between;align-items:center}
.left{display:flex;align-items:center;gap:10px}
.logo{width:36px;height:36px;border-radius:8px;overflow:hidden;background:#fff}
.logo img{width:100%;height:100%;object-fit:contain}
.symbol{font-weight:800}
.price-line{font-size:12px;color:var(--muted)}
.score{font-weight:900;font-size:1.05rem}
.sspi-bar{height:6px;border-radius:6px;background:rgba(0,0,0,0.06);overflow:hidden;margin-top:4px}
.sspi-fill{height:100%;background:var(--accent);width:0;transition:width 900ms cubic-bezier(.2,.9,.2,1)}
.trend-pill{display:inline-block;padding:3px 8px;border-radius:12px;font-size:12px;font-weight:700;color:#fff}
.trend-pill.up{background:var(--good)}.trend-pill.down{background:var(--bad)}.trend-pill.neutral{background:var(--neutral)}
.sparkline{width:100%;height:30px;border-radius:6px;object-fit:cover;margin-top:6px}

/* tooltips */
.tooltip{position:relative;display:inline-block}
.tooltip .tooltiptext{visibility:hidden;opacity:0;max-width:340px;background:rgba(0,0,0,0.92);color:#fff;text-align:left;border-radius:8px;padding:8px;position:absolute;z-index:9999;top:130%;left:50%;transform:translateX(-50%);transition:opacity .18s;font-size:13px;line-height:1.4;font-weight:400;box-shadow:0 6px 18px rgba(0,0,0,0.18)}
.tooltip:hover .tooltiptext{visibility:visible;opacity:1}
.tooltip .tooltiptext img{display:block;margin-top:6px;width:100%;height:30px;border-radius:4px;object-fit:cover}

/* summary table */
.summary-wrap{margin-top:14px;border-radius:10px;overflow-x:auto;background:rgba(0,0,0,0.02)}
table{width:100%;border-collapse:collapse;font-size:13px;min-width:560px}
th,td{padding:8px 10px;text-align:left;border-bottom:1px solid rgba(0,0,0,0.04);white-space:nowrap}
th{font-weight:800;color:var(--muted);position:sticky;top:0;background:var(--card)}
th.sortable{cursor:pointer;user-select:none}
th.asc::after{content:" ‚ñ≤";font-size:11px;color:var(--muted)}
th.desc::after{content:" ‚ñº";font-size:11px;color:var(--muted)}

/* responsive */
@media(max-width:768px){
  .indicators{grid-template-columns:repeat(2,1fr)}
  .grid{grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:8px}
  .card{padding:8px}
  #globalStats{font-size:12px}
}
@media(max-width:480px){
  .indicators{grid-template-columns:repeat(2,1fr)}
  .sparkline{height:28px}
  .tooltip .tooltiptext{left:0;transform:none;width:240px}
}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="title-row">
      <svg width="36" height="36" viewBox="0 0 24 24"><rect width="24" height="24" rx="5" fill="var(--accent)"/><path d="M5 15l3-6 3 12 3-9 3 6" stroke="#fff" stroke-width="1.1"/></svg>
      <div>
        <h1>Supply Squeeze Pressure Monitor</h1>
        <div id="lastUpdated">Last updated: -- (GMT+8)</div>
        <div id="globalStats">Loading global stats‚Ä¶</div>
      </div>
    </div>

    <div class="controls">
      <select id="refreshSelect"><option value="5">5m</option><option value="10">10m</option><option value="30" selected>30m</option></select>
      <button id="refreshNow" class="btn-primary">Refresh</button>
      <button id="themeToggle" class="btn-ghost">üåô</button>
    </div>
  </header>

  <div class="scale-wrap" aria-hidden="true">
    <div class="scale" id="scaleBar"></div>
    <div id="marker" class="marker" style="left:50%;display:none"><div class="marker-dot" id="markerDot">--</div></div>
  </div>

  <div id="moodBar" style="background:linear-gradient(90deg,#94a3b8,#94a3b8);color:#fff">Market Mood: --</div>

  <div class="indicators" id="indicators">
    <div class="ind-card tooltip"><div class="ind-label">RSI</div><div class="ind-value" id="indRSI">‚Äî</div>
      <span class="tooltiptext">Relative Strength Index (0‚Äì100). RSI &gt; 70 ‚Üí overbought; &lt; 30 ‚Üí oversold.</span>
    </div>
    <div class="ind-card tooltip"><div class="ind-label">ADX</div><div class="ind-value" id="indADX">‚Äî</div>
      <span class="tooltiptext">Average Directional Index (trend strength). ADX &gt; 25 ‚Üí strong trend.</span>
    </div>
    <div class="ind-card tooltip"><div class="ind-label">Supertrend</div><div class="ind-value" id="indSuper">‚Äî</div>
      <span class="tooltiptext">Supertrend overlay (ATR-based). Green ‚Üí bullish; Red ‚Üí bearish.</span>
    </div>
    <div class="ind-card tooltip"><div class="ind-label">Altseason</div><div class="ind-value" id="indAlt">‚Äî</div>
      <span class="tooltiptext">Altseason index: higher ‚Üí altcoins outperform BTC.</span>
    </div>
  </div>

  <div id="grid" class="grid" aria-live="polite"></div>

  <div class="summary-wrap">
    <table id="summaryTable" role="table">
      <thead>
        <tr>
          <th>#</th>
          <th class="sortable" data-key="symbol">Coin</th>
          <th class="sortable" data-key="sspi">SSPI <span class="tooltip">?<span class="tooltiptext">SSPI = 0.6 √ó normalized 30-day price change + 0.4 √ó normalized log‚ÇÅ‚ÇÄ(market cap / volume). 70+ = high, 40‚Äì69 = neutral, &lt;40 = loose supply.</span></span></th>
          <th class="sortable" data-key="trend">Status <span class="tooltip">?<span class="tooltiptext">Trend summary (Supertrend / ADX proxy): Uptrend/Downtrend/Neutral. ADX indicates strength.</span></span></th>
          <th class="sortable" data-key="vol">Vol <span class="tooltip">?<span class="tooltiptext">Volatility % from recent 7-day sparkline (last 30 points). Higher = choppier.</span></span></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
/* CONFIG: coins */
const coins = [
  {id:'bitcoin',sym:'BTC'},
  {id:'ethereum',sym:'ETH'},
  {id:'ripple',sym:'XRP'},
  {id:'cardano',sym:'ADA'},
  {id:'solana',sym:'SOL'},
  {id:'stellar',sym:'XLM'},
  {id:'dogecoin',sym:'DOGE'},
  {id:'chainlink',sym:'LINK'},
  {id:'avalanche-2',sym:'AVAX'},
  {id:'algorand',sym:'ALGO'},
  {id:'hedera-hashgraph',sym:'HBAR'},
  {id:'cosmos',sym:'ATOM'}
];

function malaysiaDateTime(){
  return new Intl.DateTimeFormat('en-GB',{timeZone:'Asia/Kuala_Lumpur',year:'numeric',month:'short',day:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit'}).format(new Date());
}

async function safeFetch(url, timeout = 12000){
  try{
    const ctrl = new AbortController();
    const id = setTimeout(()=>ctrl.abort(), timeout);
    const res = await fetch(url, {signal: ctrl.signal});
    clearTimeout(id);
    if(!res.ok) return null;
    return await res.json();
  }catch(e){ return null; }
}

/* MATH helpers */
function normalize(v,min,max){ if(typeof v!=='number' || isNaN(v)) return 0; const c=Math.max(min,Math.min(max,v)); return ((c-min)/(max-min))*100; }
function volatilityPercent(arr){ if(!arr||arr.length<2) return null; const nums=arr.map(Number); const mean=nums.reduce((a,b)=>a+b,0)/nums.length; const sd=Math.sqrt(nums.reduce((a,b)=>a+Math.pow(b-mean,2),0)/nums.length); return +(sd/Math.max(1,Math.abs(mean))*100).toFixed(2); }

/* SSPI */
function computeSSPI(item, periodDays=30){
  let p = item.price_change_percentage_30d_in_currency;
  if((p==null || periodDays===7) && item.sparkline_in_7d?.price){
    const arr = item.sparkline_in_7d.price;
    const slice = arr.slice(-168); // approx 7d
    const a = slice[0], b = slice[slice.length-1];
    p = a ? ((b-a)/Math.abs(a))*100 : 0;
  }
  const vol = item.total_volume || 1;
  const m = item.market_cap || 1;
  const ill = normalize(p, -50, 50);
  const ssr = normalize(Math.log10(Math.max(1,m/Math.max(1,vol))), 0, 6);
  return Math.round(ill*0.6 + ssr*0.4);
}

/* RSI (14) */
function computeRSI(arr, period=14){
  if(!arr || arr.length < period+1) return null;
  const closes = arr.map(Number);
  let gains=0, losses=0;
  for(let i=1;i<=period;i++){
    const diff = closes[i]-closes[i-1];
    if(diff>0) gains+=diff; else losses+=Math.abs(diff);
  }
  let avgGain = gains/period, avgLoss = losses/period;
  for(let i=period+1;i<closes.length;i++){
    const d = closes[i]-closes[i-1];
    avgGain = (avgGain*(period-1) + Math.max(0,d))/period;
    avgLoss = (avgLoss*(period-1) + Math.max(0,-d))/period;
  }
  if(avgLoss===0) return 100;
  const rs = avgGain/avgLoss;
  const rsi = 100 - (100/(1+rs));
  return +rsi.toFixed(2);
}

/* ADX-like proxy: slope / vol normalized (not true ADX but gives strength) */
function computeADXProxy(arr){
  if(!arr || arr.length<10) return null;
  const nums = arr.map(Number);
  const slope = (nums[nums.length-1] - nums[0]) / Math.max(1, Math.abs(nums[0])) * 100;
  const vol = (function(){
    const mean = nums.reduce((a,b)=>a+b,0)/nums.length;
    const sd = Math.sqrt(nums.reduce((a,b)=>a+Math.pow(b-mean,2),0)/nums.length);
    return +(sd/Math.max(1,Math.abs(mean))*100).toFixed(2);
  })();
  const proxy = Math.abs(slope)/Math.max(1,vol); // higher => stronger
  return +(proxy*10).toFixed(2); // scale for readability
}

/* Supertrend simple proxy: compare last price to moving average +/- ATR */
function computeSupertrend(arr){
  if(!arr || arr.length<10) return {trend:'Neutral',value:null};
  const nums = arr.map(Number);
  // ATR proxy = avg of absolute returns
  let trSum=0;
  for(let i=1;i<nums.length;i++) trSum += Math.abs(nums[i]-nums[i-1]);
  const atr = trSum/(nums.length-1);
  // simple moving average of last 10
  const sma = nums.slice(-10).reduce((a,b)=>a+b,0)/10;
  const last = nums[nums.length-1];
  if(last > sma + atr*0.6) return {trend:'Bullish',value: +(last - (sma+atr)).toFixed(4)};
  if(last < sma - atr*0.6) return {trend:'Bearish',value: +((sma - atr) - last).toFixed(4)};
  return {trend:'Neutral',value:0};
}

/* quickchart sparkline URL builder */
function quickchartSpark(arr){
  try{
    const cfg = {type:'sparkline',data:{datasets:[{data: arr || []}]},options:{responsive:true}};
    return 'https://quickchart.io/chart?c=' + encodeURIComponent(JSON.stringify(cfg));
  }catch(e){ return ''; }
}

/* update global stats (CoinGecko global + FNG) */
async function loadGlobalStats(){
  const cg = await safeFetch('https://api.coingecko.com/api/v3/global');
  const fng = await safeFetch('https://api.alternative.me/fng/');
  let cap='--', btcDom='--', fngVal='--', fngFace='üòê';
  if(cg?.data){
    cap = +(cg.data.total_market_cap.usd/1e9).toFixed(1);
    btcDom = +cg.data.market_cap_percentage.btc.toFixed(1);
  }
  if(fng?.data?.[0]){
    fngVal = fng.data[0].value;
    const v = parseInt(fngVal||0);
    fngFace = v>=75?'üòÑ':v>=55?'üôÇ':v>=45?'üòê':v>=25?'üòü':'üò±';
  }
  document.getElementById('globalStats').innerHTML = `üåç MCap: ${cap} B &nbsp;&nbsp;üü† BTC Dom: ${btcDom}% &nbsp;&nbsp;${fngFace} F&G: ${fngVal}`;
  // Altseason: compute simple altseason index using CoinGecko global? We approximate via ratio altcap/btccap using cg data if present
  let altIdx = '--';
  if(cg?.data && cg.data.market_cap_percentage){
    // altseason proxy: (100 - btcDominance) scaled 0-100
    altIdx = Math.round(100 - (cg.data.market_cap_percentage.btc || 0));
  }
  document.getElementById('indAlt').textContent = altIdx === '--' ? '--' : altIdx + '%';
}

/* Render main view */
async function loadData(){
  document.getElementById('lastUpdated').textContent = 'Fetching‚Ä¶';
  const ids = coins.map(c=>c.id).join(',');
  const url = `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${encodeURIComponent(ids)}&order=market_cap_desc&per_page=250&page=1&sparkline=true&price_change_percentage=30d`;
  const data = await safeFetch(url, 12000);
  if(!data){
    document.getElementById('grid').innerHTML = '<div style="padding:12px;color:var(--muted)">Data unavailable ‚Äî check network.</div>';
    document.getElementById('lastUpdated').textContent = 'Data unavailable: ' + malaysiaDateTime() + ' (GMT+8)';
    return;
  }

  // build cards
  const grid = document.getElementById('grid'); grid.innerHTML = '';
  const rows = [];
  for(const item of data){
    try{
      const sspi = computeSSPI(item, 30);
      const vol = volatilityPercent(item.sparkline_in_7d?.price?.slice(-30));
      const spark = item.sparkline_in_7d?.price || [];
      const rsi = computeRSI(spark.slice(-50)); // recent RSI
      const adx = computeADXProxy(spark.slice(-60));
      const supert = computeSupertrend(spark.slice(-40));
      // create card
      const card = document.createElement('div'); card.className = 'card';
      const cardHtml = `
        <div class="card-row">
          <div class="left">
            <div class="logo"><img src="${item.image}" alt="${item.symbol}"></div>
            <div>
              <div class="symbol">${item.symbol.toUpperCase()}</div>
              <div class="price-line">$${item.current_price!=null?item.current_price.toLocaleString('en-GB',{minimumFractionDigits:2,maximumFractionDigits:4}):'n/a'}</div>
            </div>
          </div>
          <div style="text-align:right">
            <div class="score">${sspi}</div>
            <div style="margin-top:6px"><span class="trend-pill ${supert.trend==='Bullish'?'up':supert.trend==='Bearish'?'down':'neutral'}">${supert.trend}</span></div>
          </div>
        </div>
        <div class="sspi-bar"><div class="sspi-fill" style="width:0%" data-sspi="${sspi}"></div></div>
        <img class="sparkline" src="${quickchartSpark(spark.slice(-56))}" alt="sparkline" />
        <div style="display:flex;gap:8px;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:4px">
          <div>RSI: ${rsi!=null?rsi:'‚Äî'}</div>
          <div>ADX: ${adx!=null?adx:'‚Äî'}</div>
          <div>Vol: ${vol!=null?vol+'%':'‚Äî'}</div>
        </div>
      `;
      card.innerHTML = cardHtml;
      grid.appendChild(card);

      // animate fill after appended
      requestAnimationFrame(()=> {
        const fill = card.querySelector('.sspi-fill');
        if(fill){ fill.style.width = (fill.dataset.sspi || 0) + '%'; }
      });

      rows.push({
        id:item.id,
        symbol:item.symbol.toUpperCase(),
        sspi, vol, trend:supert.trend,
        price:item.current_price, change:item.price_change_percentage_24h,
        rsi: rsi!=null? rsi:'‚Äî', adx: adx!=null? adx:'‚Äî', spark
      });
    }catch(err){
      console.warn('render item error', err);
      continue;
    }
  }

  // update top marker & mood bar colors & indicators
  const avg = rows.length ? Math.round(rows.reduce((a,b)=>a+b.sspi,0)/rows.length) : NaN;
  if(!isNaN(avg)){
    const marker = document.getElementById('marker'), markerDot = document.getElementById('markerDot');
    marker.style.display = 'block';
    marker.style.left = Math.max(0, Math.min(100, avg)) + '%';
    markerDot.textContent = avg;
  }

  // color-coded mood bar
  const mood = document.getElementById('moodBar');
  let bg = 'linear-gradient(90deg,#94a3b8,#94a3b8)', emoji='üòê', text='Neutral';
  if(avg >= 70){ bg = 'linear-gradient(90deg,#16a34a,#059669)'; emoji='üü¢'; text='Bullish Tightness'; }
  else if(avg >= 40){ bg = 'linear-gradient(90deg,#f59e0b,#f97316)'; emoji='üü°'; text='Neutral Supply'; }
  else { bg = 'linear-gradient(90deg,#ef4444,#dc2626)'; emoji='üî¥'; text='Loose Supply'; }
  mood.style.background = bg;
  mood.innerHTML = `${emoji} Market Mood: <span style="font-weight:800;margin-left:6px">${text}</span>`;

  // update indicator cards (aggregate proxies)
  // compute aggregate RSI/ADX/Supertrend across coins (mean or counts)
  const rsiVals = rows.map(r=> typeof r.rsi === 'number' ? r.rsi : null).filter(Boolean);
  const adxVals = rows.map(r=> typeof r.adx === 'number' ? r.adx : null).filter(Boolean);
  const superCounts = rows.reduce((acc,r)=>{ acc[r.trend] = (acc[r.trend]||0)+1; return acc; }, {});
  const rsiAvg = rsiVals.length ? (rsiVals.reduce((a,b)=>a+b,0)/rsiVals.length).toFixed(1) : '‚Äî';
  const adxAvg = adxVals.length ? (adxVals.reduce((a,b)=>a+b,0)/adxVals.length).toFixed(1) : '‚Äî';
  const superSummary = superCounts['Bullish']? `${superCounts['Bullish']}‚ñ≤` : (superCounts['Bearish']? `${superCounts['Bearish']}‚ñº` : '‚Äî');
  document.getElementById('indRSI').textContent = rsiAvg;
  document.getElementById('indADX').textContent = adxAvg;
  document.getElementById('indSuper').textContent = superSummary;

  // altseason already loaded by loadGlobalStats -> update indAlt if available
  await loadGlobalStats();

  // render summary table
  renderTable(rows);

  document.getElementById('lastUpdated').textContent = 'Last updated: ' + malaysiaDateTime() + ' (GMT+8)';
}

/* render summary table with tooltip sparkline */
function renderTable(rows){
  const tb = document.querySelector('#summaryTable tbody'); tb.innerHTML = '';
  rows.forEach((r, idx) => {
    const sparkUrl = quickchartSpark(r.spark.slice(-56));
    const tooltip = `<span class="tooltip">${r.symbol}<span class="tooltiptext">${r.symbol}<br>Price: $${r.price!=null? r.price.toLocaleString('en-GB',{minimumFractionDigits:2,maximumFractionDigits:6}):'n/a'}<br>24h Œî: ${r.change!=null? r.change.toFixed(2)+'%':'n/a'}<br>RSI: ${r.rsi}<br>ADX: ${r.adx}<br>Updated: ${malaysiaDateTime()} (GMT+8)<br>${sparkUrl? `<img src="${sparkUrl}" alt="sparkline">` : ''}</span></span>`;
    const rowHtml = `<tr>
      <td>${idx+1}</td>
      <td>${tooltip}</td>
      <td>${r.sspi}</td>
      <td>${r.trend}</td>
      <td>${r.vol??''}</td>
    </tr>`;
    tb.insertAdjacentHTML('beforeend', rowHtml);
  });
}

/* sortable headers with reindexing of # */
document.addEventListener('click', (e)=>{
  const th = e.target.closest('th.sortable'); if(!th) return;
  const col = th.cellIndex;
  const asc = !th.classList.contains('asc');
  const tbody = document.querySelector('#summaryTable tbody');
  const rows = Array.from(tbody.querySelectorAll('tr'));
  rows.sort((a,b)=>{
    const va = a.children[col].innerText.trim();
    const vb = b.children[col].innerText.trim();
    const na = parseFloat(va); const nb = parseFloat(vb);
    if(!isNaN(na) && !isNaN(nb)) return asc ? na - nb : nb - na;
    return asc ? va.localeCompare(vb) : vb.localeCompare(va);
  });
  tbody.innerHTML = '';
  rows.forEach((r, i) => { r.children[0].textContent = i+1; tbody.appendChild(r); });
  document.querySelectorAll('th.sortable').forEach(t=>t.classList.remove('asc','desc'));
  th.classList.add(asc? 'asc' : 'desc');
});

/* init */
document.getElementById('refreshNow').addEventListener('click', loadData);
document.getElementById('themeToggle').addEventListener('click', ()=> document.body.classList.toggle('dark'));
document.getElementById('refreshSelect').addEventListener('change', (e)=>{
  const mins = Number(e.target.value) || 30;
  if(window._sspiTimer) clearInterval(window._sspiTimer);
  window._sspiTimer = setInterval(loadData, mins*60000);
});
loadData();
</script>
</body>
</html>
